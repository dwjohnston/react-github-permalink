"use strict";(self.webpackChunkreact_github_permalink=self.webpackChunkreact_github_permalink||[]).push([[468],{"./src/library/GithubIssueLink/GithubIssueLink.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,WithBackground:()=>WithBackground,WithToken:()=>WithToken,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),_GithubIssueLink__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/library/GithubIssueLink/GithubIssueLink.tsx"),_config_GithubPermalinkContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/library/config/GithubPermalinkContext.tsx"),process=(__webpack_require__("./src/library/GithubPermalink/github-permalink.css"),__webpack_require__("./node_modules/process/browser.js"));const __WEBPACK_DEFAULT_EXPORT__={component:_GithubIssueLink__WEBPACK_IMPORTED_MODULE_1__.H},Primary={render:()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_GithubIssueLink__WEBPACK_IMPORTED_MODULE_1__.H,{issueLink:"https://github.com/dwjohnston/react-github-permalink/issues/24"})},WithBackground={render:()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{backgroundColor:"pink",padding:"1em"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_GithubIssueLink__WEBPACK_IMPORTED_MODULE_1__.H,{issueLink:"https://github.com/dwjohnston/react-github-permalink/issues/24"})})},WithToken={render:()=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_config_GithubPermalinkContext__WEBPACK_IMPORTED_MODULE_2__.W,{githubToken:process.env.STORYBOOK_GITHUB_TOKEN,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_GithubIssueLink__WEBPACK_IMPORTED_MODULE_1__.H,{issueLink:"https://github.com/dwjohnston/react-github-permalink/issues/24"})})},__namedExportsOrder=["Primary","WithBackground","WithToken"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:'{\n  render: () => <GithubIssueLink issueLink="https://github.com/dwjohnston/react-github-permalink/issues/24" />\n}',...Primary.parameters?.docs?.source}}},WithBackground.parameters={...WithBackground.parameters,docs:{...WithBackground.parameters?.docs,source:{originalSource:'{\n  render: () => <div style={{\n    backgroundColor: "pink",\n    padding: "1em"\n  }}>\n      <GithubIssueLink issueLink="https://github.com/dwjohnston/react-github-permalink/issues/24" />\n    </div>\n}',...WithBackground.parameters?.docs?.source}}},WithToken.parameters={...WithToken.parameters,docs:{...WithToken.parameters?.docs,source:{originalSource:'{\n  render: () => <GithubPermalinkProvider githubToken={process.env.STORYBOOK_GITHUB_TOKEN}>\n      <GithubIssueLink issueLink="https://github.com/dwjohnston/react-github-permalink/issues/24" />\n    </GithubPermalinkProvider>\n}',...WithToken.parameters?.docs?.source}}}},"./src/library/GithubIssueLink/GithubIssueLink.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{H:()=>GithubIssueLink});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_config_GithubPermalinkContext__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/library/config/GithubPermalinkContext.tsx"),_GithubIssueLinkBase__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/library/GithubIssueLink/GithubIssueLinkBase.tsx");function GithubIssueLink(props){const{issueLink}=props,[data,setData]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null),{getIssueFn,githubToken,onError}=(0,react__WEBPACK_IMPORTED_MODULE_1__.useContext)(_config_GithubPermalinkContext__WEBPACK_IMPORTED_MODULE_2__.C),[isLoading,setIsLoading]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!0);if((0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((()=>{getIssueFn(issueLink,githubToken,onError).then((v=>{setIsLoading(!1),setData(v)}))}),[getIssueFn,githubToken,issueLink,onError]),isLoading)return null;if(!data)throw new Error("Loading is complete, but no data was returned.");return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_GithubIssueLinkBase__WEBPACK_IMPORTED_MODULE_3__.e,{...props,data})}try{GithubIssueLink.displayName="GithubIssueLink",GithubIssueLink.__docgenInfo={description:"",displayName:"GithubIssueLink",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},issueLink:{defaultValue:null,description:"",name:"issueLink",required:!0,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"inline"'},{value:'"block"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/library/GithubIssueLink/GithubIssueLink.tsx#GithubIssueLink"]={docgenInfo:GithubIssueLink.__docgenInfo,name:"GithubIssueLink",path:"src/library/GithubIssueLink/GithubIssueLink.tsx#GithubIssueLink"})}catch(__react_docgen_typescript_loader_error){}},"./src/library/GithubIssueLink/GithubIssueLinkBase.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{e:()=>GithubIssueLinkBase});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),GithubSvg=__webpack_require__("./src/library/GithubSvg/GithubSvg.tsx"),ErrorMessages=__webpack_require__("./src/library/ErrorMessages/ErrorMessages.tsx");const REACTIONS_MAP={"+1":"👍","-1":"👎",confused:"😕",eyes:"👀",heart:"❤️",hooray:"🎉",laugh:"😆",rocket:"🚀"};function Reactions(props){return(0,jsx_runtime.jsx)("div",{className:"reaction-bar",children:Object.entries(props.reactions).map((v=>{const[key,value]=v;if(0===value||"total_count"===key)return null;const emoji=REACTIONS_MAP[key];return emoji?(0,jsx_runtime.jsxs)("div",{className:"reaction-value",children:[(0,jsx_runtime.jsx)("span",{children:emoji}),(0,jsx_runtime.jsx)("span",{children:value})]},key):null}))})}try{Reactions.displayName="Reactions",Reactions.__docgenInfo={description:"",displayName:"Reactions",props:{reactions:{defaultValue:null,description:"",name:"reactions",required:!0,type:{name:'{ "+1": number; "-1": number; confused: number; eyes: number; heart: number; hooray: number; laugh: number; rocket: number; total_count: number; }'}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/library/common/Reactions/Reactions.tsx#Reactions"]={docgenInfo:Reactions.__docgenInfo,name:"Reactions",path:"src/library/common/Reactions/Reactions.tsx#Reactions"})}catch(__react_docgen_typescript_loader_error){}function Inline(props){const{href,text}=props;return(0,jsx_runtime.jsxs)("a",{href,className:"rgp-base react-github-issue-link-inline",children:[(0,jsx_runtime.jsx)(GithubSvg.Y,{})," ",(0,jsx_runtime.jsx)("span",{children:text})]})}try{Inline.displayName="Inline",Inline.__docgenInfo={description:"",displayName:"Inline",props:{href:{defaultValue:null,description:"",name:"href",required:!0,type:{name:"string"}},text:{defaultValue:null,description:"",name:"text",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/library/common/Inline/Inline.tsx#Inline"]={docgenInfo:Inline.__docgenInfo,name:"Inline",path:"src/library/common/Inline/Inline.tsx#Inline"})}catch(__react_docgen_typescript_loader_error){}function GithubIssueLinkBase(props){const{data,variant="block",issueLink}=props;return"inline"===variant?"ok"===data.status?(0,jsx_runtime.jsx)(Inline,{href:issueLink,text:`${data.owner}/${data.repo}#${data.issueNumber}  ${data.issueTitle}`}):(0,jsx_runtime.jsx)(Inline,{href:issueLink,text:issueLink}):"ok"===data.status?(0,jsx_runtime.jsx)(GithubIssueLinkInner,{...props,header:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"react-github-issuelink-repo",children:[(0,jsx_runtime.jsx)(GithubSvg.Y,{}),(0,jsx_runtime.jsxs)("p",{children:[data.owner,"/",data.repo]})]}),(0,jsx_runtime.jsxs)("div",{className:"react-github-issuelink-body",children:[(0,jsx_runtime.jsxs)("p",{children:[(0,jsx_runtime.jsx)("span",{className:"react-github-issuelink-title",children:data.issueTitle}),(0,jsx_runtime.jsxs)("span",{className:"react-github-issuelink-number",children:[" #",data.issueNumber]})," "]}),"open"===data.issueState?(0,jsx_runtime.jsxs)("div",{className:"react-github-issuelink-status open",children:[(0,jsx_runtime.jsxs)("svg",{"aria-hidden":"true",height:"12",viewBox:"0 0 16 16",version:"1.1",width:"12","data-view-component":"true",children:[(0,jsx_runtime.jsx)("path",{d:"M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"}),(0,jsx_runtime.jsx)("path",{d:"M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Z"})]}),(0,jsx_runtime.jsx)("span",{children:" Open"})]}):(0,jsx_runtime.jsxs)("div",{className:"react-github-issuelink-status closed",children:[(0,jsx_runtime.jsxs)("svg",{"aria-hidden":"true",height:"12",viewBox:"0 0 16 16",version:"1.1",width:"12","data-view-component":"true",children:[(0,jsx_runtime.jsx)("path",{d:"M11.28 6.78a.75.75 0 0 0-1.06-1.06L7.25 8.69 5.78 7.22a.75.75 0 0 0-1.06 1.06l2 2a.75.75 0 0 0 1.06 0l3.5-3.5Z"}),(0,jsx_runtime.jsx)("path",{d:"M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0Zm-1.5 0a6.5 6.5 0 1 0-13 0 6.5 6.5 0 0 0 13 0Z"})]}),(0,jsx_runtime.jsx)("span",{children:" Closed"})]})]}),(0,jsx_runtime.jsx)("div",{children:data.reactions&&(0,jsx_runtime.jsx)(Reactions,{reactions:data.reactions})})]})}):(0,jsx_runtime.jsx)(GithubIssueLinkInner,{...props,children:(0,jsx_runtime.jsx)(ErrorMessages.f,{data})})}function GithubIssueLinkInner(props){const{issueLink,className=""}=props;var _props_header;return(0,jsx_runtime.jsx)("div",{className:`rgp-base react-github-issuelink ${className}`,children:(0,jsx_runtime.jsxs)("a",{href:issueLink,children:[(0,jsx_runtime.jsx)("div",{className:"header",children:null!==(_props_header=props.header)&&void 0!==_props_header?_props_header:(0,jsx_runtime.jsx)("a",{href:issueLink,className:"file-link",children:issueLink})}),props.children]})})}try{GithubIssueLinkBase.displayName="GithubIssueLinkBase",GithubIssueLinkBase.__docgenInfo={description:"",displayName:"GithubIssueLinkBase",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},issueLink:{defaultValue:null,description:"",name:"issueLink",required:!0,type:{name:"string"}},data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"GithubIssueLinkDataResponse"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"inline"'},{value:'"block"'}]}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/library/GithubIssueLink/GithubIssueLinkBase.tsx#GithubIssueLinkBase"]={docgenInfo:GithubIssueLinkBase.__docgenInfo,name:"GithubIssueLinkBase",path:"src/library/GithubIssueLink/GithubIssueLinkBase.tsx#GithubIssueLinkBase"})}catch(__react_docgen_typescript_loader_error){}},"./src/library/config/GithubPermalinkContext.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{C:()=>GithubPermalinkContext,W:()=>GithubPermalinkProvider});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_defaultFunctions__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/library/config/defaultFunctions.ts");const GithubPermalinkContext=(0,react__WEBPACK_IMPORTED_MODULE_1__.createContext)({getDataFn:_defaultFunctions__WEBPACK_IMPORTED_MODULE_2__.Bj,getIssueFn:_defaultFunctions__WEBPACK_IMPORTED_MODULE_2__.Nw});function GithubPermalinkProvider(props){var _props_getDataFn,_props_getIssueFn;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(GithubPermalinkContext.Provider,{value:{getDataFn:null!==(_props_getDataFn=props.getDataFn)&&void 0!==_props_getDataFn?_props_getDataFn:_defaultFunctions__WEBPACK_IMPORTED_MODULE_2__.Bj,getIssueFn:null!==(_props_getIssueFn=props.getIssueFn)&&void 0!==_props_getIssueFn?_props_getIssueFn:_defaultFunctions__WEBPACK_IMPORTED_MODULE_2__.Nw,githubToken:props.githubToken,onError:props.onError},children:props.children})}try{GithubPermalinkProvider.displayName="GithubPermalinkProvider",GithubPermalinkProvider.__docgenInfo={description:"",displayName:"GithubPermalinkProvider",props:{getDataFn:{defaultValue:null,description:"Function to provide permalink data payload",name:"getDataFn",required:!1,type:{name:"((permalink: string, githubToken?: string, onError?: ((err: unknown) => void)) => Promise<GithubPermalinkDataResponse>) | undefined"}},getIssueFn:{defaultValue:null,description:"Function to provide issue data payload",name:"getIssueFn",required:!1,type:{name:"((issueLink: string, githubToken?: string, onError?: ((err: unknown) => void)) => Promise<GithubIssueLinkDataResponse>) | undefined"}},githubToken:{defaultValue:null,description:"A github personal access token - will be passed to the data fetching functions",name:"githubToken",required:!1,type:{name:"string"}},onError:{defaultValue:null,description:"If an error occurs while fetching the data this function will be called. \nYou can use this to report to Sentry etc\n@param e\n@returns",name:"onError",required:!1,type:{name:"((e: unknown) => void)"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/library/config/GithubPermalinkContext.tsx#GithubPermalinkProvider"]={docgenInfo:GithubPermalinkProvider.__docgenInfo,name:"GithubPermalinkProvider",path:"src/library/config/GithubPermalinkContext.tsx#GithubPermalinkProvider"})}catch(__react_docgen_typescript_loader_error){}},"./src/library/config/defaultFunctions.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{async function defaultGetIssueFn(issueLink,githubToken,onError){const config=function parseGithubIssueLink(url){const match=url.match(/^https?:\/\/github\.com\/([^/]+)\/([^/]+)\/(?:issues|pull)\/(\d+)$/);if(match){const[,owner,repo,issue]=match;return{owner,repo,issue}}throw new Error("Invalid issue link URL")}(issueLink),options=githubToken?{headers:{Authorization:`Bearer ${githubToken}`}}:void 0,issueResult=await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/issues/${config.issue}`,options);if(!issueResult.ok)return null==onError||onError(issueResult),handleResponse(issueResult);const issueJson=await issueResult.json();return{issueTitle:issueJson.title,issueNumber:config.issue,issueState:issueJson.state,status:"ok",owner:config.owner,repo:config.repo,reactions:issueJson.reactions}}async function defaultGetPermalinkFn(permalink,githubToken,onError){const config=function parseGithubPermalinkUrl(githubURL){const match=githubURL.match(/https:\/\/github\.com\/([^/]+)\/([^/]+)\/blob\/([^/]+)\/(.+)#L(\d+)(?:-L(\d+))?/);if(match){const[,owner,repo,commit,path,lineFrom,lineTo]=match;return{owner,repo,commit,path,lineFrom:parseInt(lineFrom,10),lineTo:lineTo?parseInt(lineTo,10):parseInt(lineFrom,10)}}throw new Error("Invalid permalink URL")}(permalink),options=githubToken?{headers:{Authorization:`Bearer ${githubToken}`}}:void 0,contentPromise=fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/contents/${config.path}?ref=${config.commit}`,options),commitPromise=fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/commits/${config.commit}`,options),[contentResult,commitResult]=await Promise.all([contentPromise,commitPromise]);if(!contentResult.ok)return null==onError||onError(contentResult),handleResponse(contentResult);if(!commitResult.ok)return null==onError||onError(commitResult),handleResponse(commitResult);const[contentJson,commitJson]=await Promise.all([contentResult.json(),commitResult.json()]);return{lines:atob(contentJson.content).split("\n").slice(config.lineFrom-1,config.lineTo),lineFrom:config.lineFrom,lineTo:config.lineTo,commit:config.commit,path:config.path,owner:config.owner,repo:config.repo,commitUrl:commitJson.html_url,status:"ok"}}function handleResponse(response){return 404===response.status?{status:"404"}:403===response.status&&"0"===response.headers.get("X-Ratelimit-Remaining")?{status:"rate-limit"}:401===response.status?{status:"unauthorized"}:{status:"other-error"}}__webpack_require__.d(__webpack_exports__,{Nw:()=>defaultGetIssueFn,Bj:()=>defaultGetPermalinkFn})}}]);